<div class="min-h-screen bg-gray-100 relative flex flex-col">
  <!-- Welcome Message -->
  <header class="p-6 text-black text-center shadow-md relative">
    <h1 class="text-3xl font-bold mt-4">Welcome to Your Dashboard, <%= current_user.name %>!</h1>
    <p class="text-gray-500 mt-2">Manage your books here.</p>

    <!-- Logout Button (Top Right) -->
    <div class="absolute top-0 right-0">
      <form action="<%= logout_path %>" method="post" onsubmit="return confirm('Are you sure you want to log out?');">
        <input type="hidden" name="_method" value="delete">
        <button type="submit" class="bg-red-500 text-white font-semibold py-2 px-4 rounded-xl transition duration-200">
          Logout
        </button>
      </form>
    </div>
  </header>

  <!-- Borrowed Books Section -->
  <div class="max-w-4xl mx-auto mt-8 bg-white p-6 rounded-lg shadow-md">
    <h3 class="text-3xl font-bold mb-4 text-center underline uppercase">Currently Borrowed Books</h3>

    <% if current_user.borrows.any? %>
      <table class="table-auto w-full border-collapse bg-white shadow-md rounded-xl overflow-hidden">
        <thead class="bg-gray-100 text-gray-700">
          <tr class="border-b border-black">
            <th class="px-4 py-4">#</th>
            <th class="px-4 py-4">Title</th>
            <th class="py-3 px-4 text-center">Date Borrowed</th>
            <th class="py-3 px-4 text-center">Date Due</th>
            <th class="py-3 px-4 text-center">Status</th>
            <th class="py-3 px-4 text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% current_user.borrows.where(returned_at: nil).order(due_date: :asc).each_with_index do |borrow, index| %>
            <% overdue = borrow.due_date < Time.zone.now %>
            <tr class="<%= overdue ? 'bg-red-600' : 'bg-white' %> border-b border-black">
              <td class="py-3 px-4 text-center"><%= index + 1 %></td>
              <td class="py-3 px-4 text-center font-semibold"><%= borrow.book.title %></td>
              <td class="py-3 px-4 text-center font-semibold"><%= borrow.borrowed_at.strftime('%d-%m-%Y') %></td>
              <td class="py-3 px-4 text-center font-semibold"><%= borrow.due_date.strftime('%d-%m-%Y') %></td>
              <td class="py-3 px-4 text-center font-semibold">
                <% if overdue %>
                  <span class="text-red-600 font-bold">‚ùå Overdue!</span>
                <% else %>
                  <span class="text-blue-600 font-bold">üìñ Borrowed</span>
                <% end %>
              </td>
              <td class="py-3 px-4 text-center">
                <div class="flex justify-center space-x-2"> 
                  <!-- View Book Button -->
                  <%= link_to "View", book_path(borrow.book), 
                    class: "px-4 py-2 text-white bg-blue-600 rounded-xl font-semibold shadow-md" %>
                  &nbsp;
                  &nbsp;

                  <!-- Return Button -->
                  <button onclick="if(confirm('Are you sure you want to return this book?')) { this.nextElementSibling.submit(); }"
                    class="px-4 py-2 text-white bg-green-500 rounded-xl font-bold shadow-md">
                    Return
                  </button>
                  <%= form_with url: borrow_path(borrow), method: :patch, style: "display: none;" do %>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="text-black-600 text-3xl font-bold text-center mt-4">You have no borrowed books.</p>
    <% end %>

    <!-- Buttons for Navigation -->
    <div class="mt-6 flex justify-between">
      <a href="<%= books_path %>" class="text-blue-600 font-semibold hover:underline mt-4">
        üìö Browse Books
      </a>
      <a href="<%= borrows_path %>" class="text-blue-600 font-semibold hover:underline mt-4 ">
        üìú View Borrowing History
      </a>
    </div>
  </div>
</div>
